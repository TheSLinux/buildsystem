#!/bin/bash

# Maintainer: Anh K. Huynh <kyanh@theslinux.org>

# Original Maintainer: Gaetan Bisson <bisson@archlinux.org>
# Original Contributor: damir <damir@archlinux.org>
# Original Contributor: Camille Moncelier <pix@devlife.org>

pkgdesc='Vietnamese text processing library (database)'
url='http://www.nongnu.org/m17n/'
arch=('any')
license=('GPL')
depends=('glibc') # not because of compiling, but because of /usr/share/i18n/charmaps/ files that glibc provides
source=("en-vi.patch" "en-vi-add-ipa-files.patch"
  "http://download.savannah.gnu.org/releases/m17n/m17n-db-${pkgver}.tar.gz")
sha1sums=()

replaces=('m17n-db')
provides=('m17n-db')
conflicts=('m17n-db')
install=install

build() {
  cd "${srcdir}/m17n-db-${pkgver}"
  patch -Np4 < "${srcdir}/en-vi.patch"
  # FIXME: You will have problem in the next run
  patch -Np4 < "${srcdir}/en-vi-add-ipa-files.patch"
  aclocal
  autoconf
  automake --add-missing
  ./configure --prefix=/usr
  make
}

package() {
  cd "${srcdir}/m17n-db-${pkgver}"
  make DESTDIR="${pkgdir}" install
  cd "${pkgdir}/usr/share/m17n/icons/"
  for im in viqr tcvn telex vni; do
    ln -s "vi-$im.png" "vi-$im-ipa.png"
  done
}
