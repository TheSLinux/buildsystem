#!/bin/bash

# Maintainer: Anh K. Huynh <kyanh@theslinux.org>
# Original Maintainer: Pierre Schmitz <pierre@archlinux.de>

pkgname=ca-certificates
pkgver=20130119
pkgrel=1
pkgdesc='Common CA certificates'
arch=('any')
url='http://packages.qa.debian.org/c/ca-certificates.html'
license=('MPL' 'GPL')
source=("remove-run-parts.patch"
        "http://ftp.debian.org/debian/pool/main/c/${pkgname}/${pkgname}_${pkgver}.tar.gz")
depends=('bash' 'openssl' 'findutils' 'coreutils' 'sed')
makedepends=('python2')
install='ca-certificates.install'
backup=('etc/ca-certificates.conf')
sha256sums=('beeef0dfd21d5fc9a25b37f691aeacd8a0bd8aa468f40cbc8509b8e4ef30f1f8'
        'fb51ec9a2c551838cc1646a0b3c9e6bea5c1bb20ff5d71c542451fac4b191c22')

build() {
	cd ${srcdir}/${pkgname}-${pkgver}
	sed 's|/usr/bin/python|/usr/bin/python2|g' -i mozilla/certdata2pem.py
	sed 's|python|python2|g' -i mozilla/Makefile
        patch -Np4 < "${srcdir}/remove-run-parts.patch"
	make
}

package() {
	cd ${srcdir}/${pkgname}-${pkgver}
	install -d -m755 ${pkgdir}/{etc/ca-certificates/update.d,usr/{sbin,share/ca-certificates},etc/ssl/certs}
	make install DESTDIR=${pkgdir}
	install -D -m644 sbin/update-ca-certificates.8 ${pkgdir}/usr/share/man/man8/update-ca-certificates.8

	(
	echo "# Automatically generated by ${pkgname}-${pkgver}-${pkgrel}"
	echo "# see update-ca-certificates man page"
	echo "# "
	cd ${pkgdir}/usr/share/ca-certificates
	find . -name '*.crt' | sort | cut -b3-
	) > ${pkgdir}/etc/ca-certificates.conf
}
